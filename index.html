<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–í–ú–µ—Å—Ç–µ –¥–ª—è OK.ru</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #ee8c3a, #f5c271);
            color: #333;
            min-height: 100vh;
        }
        .ok-button {
            background: #ee8c3a;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
            width: 100%;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåä –í–ú–µ—Å—Ç–µ –¥–ª—è OK.ru</h1>
        
        <div id="user-info" style="background: rgba(255,255,255,0.7); padding: 15px; border-radius: 10px; margin: 20px 0;">
            <p>üë§ –ò–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...</p>
        </div>
        
        <div style="background: rgba(255,255,255,0.7); padding: 20px; border-radius: 10px; margin: 20px 0;">
            <h3>‚úâÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å–ª–∞–Ω–∏–µ:</h3>
            <textarea id="message" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
                     style="width:100%; height:100px; padding:10px; border-radius:8px; border:1px solid #ddd;"></textarea>
            <button class="ok-button" onclick="sendMessage()">üåä –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –æ–∫–µ–∞–Ω</button>
        </div>
        
        <div style="background: rgba(255,255,255,0.7); padding: 20px; border-radius: 10px; margin: 20px 0;">
            <h3>üé£ –ü–æ–π–º–∞—Ç—å –ø–æ—Å–ª–∞–Ω–∏–µ:</h3>
            <button class="ok-button" onclick="catchMessage()">üé£ –í—ã–ª–æ–≤–∏—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ</button>
            <div id="random-message" style="margin-top: 15px; min-height: 50px;"></div>
        </div>
    </div>

    <script>
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        console.log('üöÄ –í–ú–µ—Å—Ç–µ –∑–∞–≥—Ä—É–∂–µ–Ω –≤ OK.ru');
        console.log('URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:', window.location.search);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤ iframe –ª–∏ –º—ã
        const isInIframe = window.self !== window.top;
        console.log('–í iframe:', isInIframe ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç');
        
        // ========== –†–ê–ë–û–¢–ê –° OK.RU API ==========
        function initOK() {
            if (typeof FAPI !== 'undefined') {
                console.log('‚úÖ OK API –¥–æ—Å—Ç—É–ø–µ–Ω');
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                FAPI.Client.call({
                    method: "users.getCurrentUser",
                    fields: "uid,first_name,last_name,pic_1"
                }, function(method, result) {
                    if (result) {
                        console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', result);
                        document.getElementById('user-info').innerHTML = `
                            <p>üëã –ü—Ä–∏–≤–µ—Ç, <strong>${result.first_name} ${result.last_name}</strong>!</p>
                            <p>ID: ${result.uid}</p>
                            ${result.pic_1 ? `<img src="${result.pic_1}" style="width: 50px; height: 50px; border-radius: 50%;">` : ''}
                        `;
                    }
                });
            } else {
                console.log('‚ö†Ô∏è OK API –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏');
                document.getElementById('user-info').innerHTML = `
                    <p>üëã –ü—Ä–∏–≤–µ—Ç, —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å!</p>
                    <p><small>–î–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ OK.ru</small></p>
                `;
            }
        }
        
        // ========== –§–£–ù–ö–¶–ò–ò –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ==========
        function sendMessage() {
            const message = document.getElementById('message').value.trim();
            if (!message) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è');
                return;
            }
            
            alert('‚úÖ –ü–æ—Å–ª–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –æ–∫–µ–∞–Ω!\n"' + message.substring(0, 50) + '"');
            document.getElementById('message').value = '';
            
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Supabase
            console.log('–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:', message);
        }
        
        function catchMessage() {
            const messages = [
                "–ö—Ç–æ –∏—â–µ—Ç, —Ç–æ—Ç –≤—Å–µ–≥–¥–∞ –Ω–∞–π–¥—ë—Ç —á—Ç–æ-—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ üåä",
                "–ò–Ω–æ–≥–¥–∞ —Ç–∏—à–∏–Ω–∞ –≥–æ–≤–æ—Ä–∏—Ç –≥—Ä–æ–º—á–µ —Å–ª–æ–≤ ü§´",
                "–°–µ–≥–æ–¥–Ω—è –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–π –¥–µ–Ω—å, —á—Ç–æ–±—ã —É–ª—ã–±–Ω—É—Ç—å—Å—è –Ω–µ–∑–Ω–∞–∫–æ–º—Ü—É üòä",
                "–í –∫–∞–∂–¥–æ–º –∏–∑ –Ω–∞—Å –µ—Å—Ç—å —á–∞—Å—Ç–∏—á–∫–∞ –æ–∫–µ–∞–Ω–∞ üåå",
                "–°–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ –≤–µ—â–∏ —á–∞—Å—Ç–æ –Ω–µ –≤–∏–¥–Ω—ã –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ üêö"
            ];
            
            const randomMsg = messages[Math.floor(Math.random() * messages.length)];
            
            document.getElementById('random-message').innerHTML = `
                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #ee8c3a;">
                    <p style="font-size: 16px; margin: 0;">"${randomMsg}"</p>
                    <small style="color: #666;">üé£ –í—ã–ª–æ–≤–ª–µ–Ω–æ –∏–∑ –æ–∫–µ–∞–Ω–∞ –≤ ${new Date().toLocaleTimeString()}</small>
                </div>
            `;
        }
        
        // ========== –ó–ê–ü–£–°–ö ==========
        // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –ø–µ—Ä–µ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
        setTimeout(initOK, 1000);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (—Ç–æ–ª—å–∫–æ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
        if (!isInIframe || typeof FAPI === 'undefined') {
            document.body.innerHTML += `
                <div style="position: fixed; bottom: 10px; right: 10px; background: #333; color: white; padding: 10px; border-radius: 5px; font-size: 12px;">
                    <p>–†–µ–∂–∏–º: ${isInIframe ? 'iframe' : '–ø—Ä—è–º–æ–π'}</p>
                    <p>OK API: ${typeof FAPI !== 'undefined' ? '‚úÖ' : '‚ùå'}</p>
                </div>
            `;
        }
    </script>
</body>
</html>
