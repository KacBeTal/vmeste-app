<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üåä –í–ú–µ—Å—Ç–µ | OK.ru</title>
    
    <style>
        /* –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #0c192c 0%, #1a2c42 100%);
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .app-container {
            padding: 15px;
            animation: fadeIn 0.5s ease;
        }
        
        /* –ë—ã—Å—Ç—Ä—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
        .app-header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }
        
        .app-title {
            font-size: 24px;
            color: #EE8C3A;
            margin: 10px 0;
        }
        
        .app-subtitle {
            font-size: 14px;
            opacity: 0.8;
        }
        
        /* –ë—ã—Å—Ç—Ä—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(238, 140, 58, 0.2);
            backdrop-filter: blur(10px);
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏–µ */
        .message {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #EE8C3A;
        }
        
        .message-text {
            font-style: italic;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .message-meta {
            font-size: 12px;
            opacity: 0.7;
            display: flex;
            justify-content: space-between;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #EE8C3A, #FF9E5C);
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        /* –°—Ç–∞—Ç—É—Å */
        .status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(238, 140, 58, 0.2);
            border-radius: 20px;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #50E3C2;
            animation: pulse 2s infinite;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            gap: 15px;
        }
        
        .loader-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(238, 140, 58, 0.2);
            border-top: 3px solid #EE8C3A;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è */
        @media (max-width: 400px) {
            .app-container {
                padding: 10px;
            }
            
            .card {
                padding: 15px;
            }
            
            .btn {
                padding: 14px;
                font-size: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container" id="app">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="app-header">
            <div style="font-size: 32px; margin-bottom: 5px;">üåä</div>
            <h1 class="app-title">–í–ú–µ—Å—Ç–µ</h1>
            <p class="app-subtitle">–ê–Ω–æ–Ω–∏–º–Ω—ã–µ –ø–æ—Å–ª–∞–Ω–∏—è –≤ OK.ru</p>
            <div class="status" id="connection-status">
                <div class="status-dot"></div>
                <span>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
            </div>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div id="content">
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        </div>
        
        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div style="margin-top: 20px;">
            <button class="btn btn-primary" onclick="sendMessage()">
                ‚úçÔ∏è –ë—Ä–æ—Å–∏—Ç—å –ø–æ—Å–ª–∞–Ω–∏–µ
            </button>
            <button class="btn btn-secondary" onclick="catchMessage()">
                üé£ –ü–æ–π–º–∞—Ç—å –ø–æ—Å–ª–∞–Ω–∏–µ
            </button>
        </div>
    </div>

    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
        const APP_CONFIG = {
            // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑ Supabase
            apiUrl: 'https://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä.—Ä—Ñ/api',
            okAppId: '', // –í–∞—à APP_ID –∏–∑ OK
            useMockData: true // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–∫–∞
        };
        
        // ========== –ü–û–õ–£–ß–ï–ù–ò–ï –î–ê–ù–ù–´–• –ò–ó OK ==========
        function getOKParams() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç OK
            const params = {
                viewer_id: urlParams.get('viewer_id') || urlParams.get('uid'),
                session_key: urlParams.get('session_key'),
                auth_key: urlParams.get('auth_key'),
                api_server: urlParams.get('api_server'),
                is_app_user: urlParams.get('is_app_user') === '1',
                referrer: urlParams.get('referrer'),
                location: urlParams.get('location')
            };
            
            console.log('üì± –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç OK:', params);
            
            // –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–µ—Ç - –¥–µ–º–æ —Ä–µ–∂–∏–º
            if (!params.viewer_id) {
                console.warn('‚ö†Ô∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã OK –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –≤–∫–ª—é—á–∞—é –¥–µ–º–æ-—Ä–µ–∂–∏–º');
                return {
                    viewer_id: 'demo_user_' + Date.now(),
                    is_app_user: false,
                    demo_mode: true
                };
            }
            
            return params;
        }
        
        // ========== –ë–´–°–¢–†–ê–Ø –ó–ê–ì–†–£–ó–ö–ê ==========
        function showLoading(message = '–ó–∞–≥—Ä—É–∑–∫–∞...') {
            document.getElementById('content').innerHTML = `
                <div class="loader">
                    <div class="loader-spinner"></div>
                    <div>${message}</div>
                </div>
            `;
            
            document.getElementById('connection-status').innerHTML = `
                <div class="status-dot" style="background: #EE8C3A"></div>
                <span>${message}</span>
            `;
        }
        
        function showMainContent() {
            const params = getOKParams();
            const isDemo = params.demo_mode;
            
            let userName = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å OK';
            let userAvatar = 'https://ui-avatars.com/api/?name=OK+User&background=EE8C3A&color=fff&size=200';
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å viewer_id, –º–æ–∂–µ–º –ø–æ–∫–∞–∑–∞—Ç—å ID
            if (params.viewer_id && !isDemo) {
                userName = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${params.viewer_id.slice(-6)}`;
            }
            
            document.getElementById('content').innerHTML = `
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <img src="${userAvatar}" alt="${userName}" 
                             style="width: 50px; height: 50px; border-radius: 50%; border: 2px solid #EE8C3A;">
                        <div>
                            <h3 style="color: #EE8C3A;">${userName}</h3>
                            <div style="font-size: 12px; opacity: 0.8;">
                                ${isDemo ? 'üî∏ –î–µ–º–æ-—Ä–µ–∂–∏–º' : '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ OK.ru'}
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0;">
                        <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                            <div style="font-size: 20px; font-weight: bold; color: #EE8C3A;">0</div>
                            <div style="font-size: 11px; opacity: 0.8;">–ü–æ—Å–ª–∞–Ω–∏–π</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                            <div style="font-size: 20px; font-weight: bold; color: #EE8C3A;">0</div>
                            <div style="font-size: 11px; opacity: 0.8;">–ü–æ–π–º–∞–Ω–æ</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #EE8C3A;">üåä –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å–ª–∞–Ω–∏—è</h3>
                    
                    <div class="message">
                        <div class="message-text">
                            "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ! –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–µ–ª–∏—Ç—å—Å—è –º—ã—Å–ª—è–º–∏ –∞–Ω–æ–Ω–∏–º–Ω–æ."
                        </div>
                        <div class="message-meta">
                            <span>üë§ –ê–Ω–æ–Ω–∏–º</span>
                            <span>–¢–æ–ª—å–∫–æ —á—Ç–æ</span>
                        </div>
                    </div>
                    
                    <div class="message">
                        <div class="message-text">
                            "–ö—Ç–æ —Ç–æ–∂–µ –∑–∞—Ö–æ–¥–∏—Ç —Å—é–¥–∞ –∏–∑ –û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–æ–≤? üì±"
                        </div>
                        <div class="message-meta">
                            <span>üë§ OK-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                            <span>5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥</span>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('connection-status').innerHTML = `
                <div class="status-dot"></div>
                <span>${isDemo ? '–î–µ–º–æ-—Ä–µ–∂–∏–º' : '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ OK.ru'}</span>
            `;
        }
        
        // ========== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function sendMessage() {
            const message = prompt('–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ –ø–æ—Å–ª–∞–Ω–∏–µ –¥–ª—è –æ–∫–µ–∞–Ω–∞:');
            
            if (message && message.trim().length > 2) {
                // –ü—Ä–æ—Å—Ç–∞—è –∏–º–∏—Ç–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                messageDiv.style.animation = 'fadeIn 0.5s ease';
                
                messageDiv.innerHTML = `
                    <div class="message-text">"${message}"</div>
                    <div class="message-meta">
                        <span>üë§ –í—ã</span>
                        <span>–¢–æ–ª—å–∫–æ —á—Ç–æ</span>
                    </div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
                const messagesContainer = document.querySelector('.card:last-child');
                if (messagesContainer) {
                    messagesContainer.insertBefore(messageDiv, messagesContainer.firstChild);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showQuickAlert('‚úÖ –ü–æ—Å–ª–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –æ–∫–µ–∞–Ω!');
            }
        }
        
        function catchMessage() {
            const messages = [
                "–ü—Ä–∏–≤–µ—Ç –∏–∑ –û–ö! –ö–∞–∫ –¥–µ–ª–∞?",
                "–ö—Ç–æ-–Ω–∏–±—É–¥—å –∑–¥–µ—Å—å —Ç–æ–∂–µ –ª—é–±–∏—Ç –∞–Ω–æ–Ω–∏–º–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ?",
                "–°–µ–≥–æ–¥–Ω—è –æ—Ç–ª–∏—á–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –Ω–æ–≤—ã—Ö –∑–Ω–∞–∫–æ–º—Å—Ç–≤!",
                "–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å, —á—Ç–æ —Ö–æ—Ä–æ—à–µ–≥–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ —Å –≤–∞–º–∏ —Å–µ–≥–æ–¥–Ω—è?",
                "–ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ —Å–≤–æ–±–æ–¥–∞ —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏—è üí´"
            ];
            
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.style.animation = 'fadeIn 0.5s ease';
            messageDiv.style.borderLeftColor = '#50E3C2';
            
            messageDiv.innerHTML = `
                <div class="message-text">"${randomMessage}"</div>
                <div class="message-meta">
                    <span>üé£ –ü–æ–π–º–∞–Ω–æ!</span>
                    <span>–¢–æ–ª—å–∫–æ —á—Ç–æ</span>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
            const messagesContainer = document.querySelector('.card:last-child');
            if (messagesContainer) {
                messagesContainer.insertBefore(messageDiv, messagesContainer.firstChild);
            }
            
            // –≠—Ñ—Ñ–µ–∫—Ç
            document.querySelectorAll('.btn').forEach(btn => {
                btn.style.transform = 'scale(0.95)';
                setTimeout(() => btn.style.transform = '', 200);
            });
            
            showQuickAlert('üé£ –í—ã –ø–æ–π–º–∞–ª–∏ –Ω–æ–≤–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ!');
        }
        
        // ========== –£–¢–ò–õ–ò–¢–´ ==========
        function showQuickAlert(text) {
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const alert = document.createElement('div');
            alert.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #EE8C3A;
                color: white;
                padding: 12px 20px;
                border-radius: 10px;
                z-index: 1000;
                animation: fadeIn 0.3s ease;
                font-weight: 500;
                box-shadow: 0 4px 20px rgba(238, 140, 58, 0.3);
            `;
            alert.textContent = text;
            
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.style.animation = 'fadeIn 0.3s ease reverse';
                setTimeout(() => alert.remove(), 300);
            }, 2000);
        }
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –í–ú–µ—Å—Ç–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
            
            // 1. –°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
            showLoading('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ OK.ru...');
            
            // 2. –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            setTimeout(() => {
                const params = getOKParams();
                console.log('‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª—É—á–µ–Ω—ã:', params);
                
                // 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
                showMainContent();
                
                // 4. –ï—Å–ª–∏ –µ—Å—Ç—å viewer_id, –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                if (params.viewer_id && !params.demo_mode) {
                    setTimeout(() => {
                        showQuickAlert('üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –∏–∑ OK.ru!');
                    }, 500);
                }
                
                // 5. –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É –¥–ª—è iframe
                adaptToIframe();
                
            }, 800); // –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏–π –¥–ª—è –ª—É—á—à–µ–≥–æ UX
            document.addEventListener('touchstart', function() {}, {passive: true});
        });
        
        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –≤—ã—Å–æ—Ç—ã –¥–ª—è iframe OK
        function adaptToIframe() {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—ã—Å–æ—Ç—É —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É –æ–∫–Ω—É
            function updateHeight() {
                const height = document.documentElement.scrollHeight;
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—é (–µ—Å–ª–∏ –º—ã –≤ iframe)
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'iframeResize',
                        height: height,
                        app: 'vmeste-ok'
                    }, '*');
                }
                
                // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –≤—ã—Å–æ—Ç—É —Å–∞–º–æ–≥–æ iframe
                document.body.style.minHeight = height + 'px';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
            const observer = new MutationObserver(updateHeight);
            observer.observe(document.body, {
                childList: true,
                subtree: true,
                attributes: true
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ —Ä–µ—Å–∞–π–∑–µ
            window.addEventListener('resize', updateHeight);
            
            // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            setTimeout(updateHeight, 100);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–∫–Ω–∞
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'getHeight') {
                const height = document.documentElement.scrollHeight;
                event.source.postMessage({
                    type: 'heightResponse',
                    height: height
                }, event.origin);
            }
        });
    </script>
</body>
</html>
